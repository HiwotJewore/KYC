{"filter":false,"title":"app.py","tooltip":"/WriteToDynamoLambdaFunction/app.py","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":0,"column":20},"end":{"row":37,"column":0},"action":"insert","lines":["\"Lambda function for writing application csv to DynamoDB table\"","import os","import csv","import boto3","","env_table = os.environ['TABLE']","","s3 = boto3.client('s3')","unzipped_s3_prefix = \"unzipped/\"","dynamodb = boto3.resource('dynamodb')","ddb_table = dynamodb.Table(env_table)","","def parse_csv_ddb(app_uuid, details_file):","    \"Load CSV and save to dynamo\"","    with open(details_file, 'r', encoding=\"utf-8\") as file:","        reader = csv.DictReader(file)","        details_dict = next(reader)","","    ddb_table.put_item(Item={**details_dict, \"APP_UUID\": app_uuid})","","    return details_dict","","def lambda_handler(event, context):","    \"Called from step functions to load CSV to DynamoDB\"","    bucket = event['detail']['bucket']['name']","    app_uuid = event['application']['app_uuid']","    details_key = f\"{unzipped_s3_prefix}{app_uuid}_details.csv\"","    details_file = f\"/tmp/{app_uuid}_details.csv\"","","    s3.download_file(bucket, details_key, details_file)","    csv_dict = parse_csv_ddb(app_uuid, details_file)","","    return {","        \"driver_license_id\": csv_dict['DOCUMENT_NUMBER'],","        \"validation_override\": True,","        \"app_uuid\": app_uuid","    }",""],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":37,"column":0},"action":"remove","lines":["# Add your code here\"Lambda function for writing application csv to DynamoDB table\"","import os","import csv","import boto3","","env_table = os.environ['TABLE']","","s3 = boto3.client('s3')","unzipped_s3_prefix = \"unzipped/\"","dynamodb = boto3.resource('dynamodb')","ddb_table = dynamodb.Table(env_table)","","def parse_csv_ddb(app_uuid, details_file):","    \"Load CSV and save to dynamo\"","    with open(details_file, 'r', encoding=\"utf-8\") as file:","        reader = csv.DictReader(file)","        details_dict = next(reader)","","    ddb_table.put_item(Item={**details_dict, \"APP_UUID\": app_uuid})","","    return details_dict","","def lambda_handler(event, context):","    \"Called from step functions to load CSV to DynamoDB\"","    bucket = event['detail']['bucket']['name']","    app_uuid = event['application']['app_uuid']","    details_key = f\"{unzipped_s3_prefix}{app_uuid}_details.csv\"","    details_file = f\"/tmp/{app_uuid}_details.csv\"","","    s3.download_file(bucket, details_key, details_file)","    csv_dict = parse_csv_ddb(app_uuid, details_file)","","    return {","        \"driver_license_id\": csv_dict['DOCUMENT_NUMBER'],","        \"validation_override\": True,","        \"app_uuid\": app_uuid","    }",""],"id":3},{"start":{"row":0,"column":0},"end":{"row":37,"column":0},"action":"insert","lines":["\"Lambda function for writing application csv to DynamoDB table\"","import os","import csv","import boto3","","env_table = os.environ['TABLE']","","s3 = boto3.client('s3')","unzipped_s3_prefix = \"unzipped/\"","dynamodb = boto3.resource('dynamodb')","ddb_table = dynamodb.Table(env_table)","","def parse_csv_ddb(app_uuid, details_file):","    \"Load CSV and save to dynamo\"","    with open(details_file, 'r', encoding=\"utf-8\") as file:","        reader = csv.DictReader(file)","        details_dict = next(reader)","","    ddb_table.put_item(Item={**details_dict, \"APP_UUID\": app_uuid})","","    return details_dict","","def lambda_handler(event, context):","    \"Called from step functions to load CSV to DynamoDB\"","    bucket = event['detail']['bucket']['name']","    app_uuid = event['application']['app_uuid']","    details_key = f\"{unzipped_s3_prefix}{app_uuid}_details.csv\"","    details_file = f\"/tmp/{app_uuid}_details.csv\"","","    s3.download_file(bucket, details_key, details_file)","    csv_dict = parse_csv_ddb(app_uuid, details_file)","","    return {","        \"driver_license_id\": csv_dict['DOCUMENT_NUMBER'],","        \"validation_override\": True,","        \"app_uuid\": app_uuid","    }",""]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":37,"column":0},"end":{"row":37,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1750920097034,"hash":"d0f1e3bd2defdbfa85c60c878f1e8449ff1c4e2c"}